# GAS デプロイ手順

このファイルは、Google Apps Script (GAS) のデプロイ手順を説明します。

## 前提条件
- Googleスプレッドシート「作業者交替管理一覧表」にアクセス権限があること
- シート名が「作業者交替管理一覧表」であること
- データが3行目から開始していること（1-2行目はヘッダー）

## デプロイ手順

### 1. スプレッドシートを開く
対象のスプレッドシートを開きます。

### 2. Apps Scriptエディタを開く
1. メニューバーから「拡張機能」→「Apps Script」をクリック
2. 新しいタブでApps Scriptエディタが開きます

### 3. スクリプトをコピー
1. デフォルトで作成されている `Code.gs` ファイルの内容を全て削除
2. `gas/Code.gs` ファイルの内容をコピー＆ペースト
3. `Ctrl + S` (または `Cmd + S`) で保存

### 4. テスト実行（オプション）
1. エディタ上部の関数選択ドロップダウンから `testDoGet` を選択
2. 「実行」ボタンをクリック
3. 初回実行時は権限の承認が必要：
   - 「権限を確認」をクリック
   - Googleアカウントを選択
   - 「詳細」→「安全ではないページに移動」をクリック（自作スクリプトなので安全です）
   - 「許可」をクリック
4. 実行ログを確認：
   - 「実行ログ」タブでデータ件数と最初の3件が表示されればOK

### 5. Webアプリとしてデプロイ
1. エディタ右上の「デプロイ」ボタンをクリック
2. 「新しいデプロイ」を選択
3. デプロイ設定：
   - **種類**: 「ウェブアプリ」を選択
   - **説明**: 「OSG Data API v1」など（任意）
   - **次のユーザーとして実行**: 「自分」を選択
   - **アクセスできるユーザー**: 
     - テスト段階: 「自分のみ」を選択
     - 本番環境: 「全員」を選択（社内20名がアクセスする場合）
4. 「デプロイ」ボタンをクリック
5. 再度権限の承認が求められる場合があります（手順4と同様）

### 6. デプロイURLを取得
1. デプロイ完了後、「ウェブアプリ」URLが表示されます
2. このURLをコピーして保管
   - 形式: `https://script.google.com/macros/s/【デプロイID】/exec`
3. このURLを `OSG-app/js/config.js` の `GAS_URL` に設定します

### 7. 動作確認
1. コピーしたURLをブラウザで直接開く
2. JSON形式でデータが返却されればOK
   ```json
   {
     "data": [...],
     "count": 5689,
     "timestamp": "2026-01-29T12:00:00"
   }
   ```

## 更新手順

スクリプトを修正した場合：

1. Apps Scriptエディタで修正
2. 保存 (`Ctrl + S`)
3. 「デプロイ」→「デプロイを管理」
4. 既存のデプロイの右側の鉛筆アイコンをクリック
5. 「バージョン」を「新バージョン」に変更
6. 「デプロイ」をクリック

**注意**: URLは変わりません。そのままフロントエンドで使用できます。

## トラブルシューティング

### エラー: "シートが見つかりません"
- シート名が「作業者交替管理一覧表」と完全に一致しているか確認

### エラー: "権限がありません"
- スプレッドシートの所有者または編集権限があるか確認
- Apps Scriptの実行権限を再度承認

### データが空で返ってくる
- スプレッドシートの3行目以降にデータがあるか確認
- `testDoGet` 関数で実行ログを確認

### CORS エラー
- GASは自動的にCORSを処理しますが、問題がある場合は `createJsonResponse` 関数内でヘッダーを追加できます

## セキュリティに関する注意

- **「自分のみ」設定**: H.T.さんのGoogleアカウントでのみアクセス可能
- **「全員」設定**: URLを知っている誰でもアクセス可能
  - 将来的にOAuth認証を追加することを推奨
  - URLを社内のみで共有し、外部に漏らさないこと

## 次のステップ

GASのデプロイが完了したら、デプロイURLを使ってフロントエンド側の実装を進めます。
